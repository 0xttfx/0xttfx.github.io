<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Networking - Category - 0xttfx</title>
    <link>http://0xttfx.tcpip.net.br/categories/networking/</link>
    <description>Vicissitudes e Adjacências</description>
    <generator>Hugo 0.142.0 &amp; FixIt v0.3.17-8b402129</generator>
    <language>en</language>
    <managingEditor>thiago.faioli@gmail.com (Faioli a.k.a 0xttfx)</managingEditor>
    <webMaster>thiago.faioli@gmail.com (Faioli a.k.a 0xttfx)</webMaster>
    <copyright>Running on [OpenBSD](https://openbsd.org) and [httpd](https://man.openbsd.org/httpd.8) |  [0xttfx](https://0xttfx.tcpip.net.br) - [BSD-3-Clause](https://spdx.org/licenses/BSD-3-Clause)</copyright>
    <lastBuildDate>Thu, 06 Mar 2025 00:15:20 -0300</lastBuildDate>
    <atom:link href="http://0xttfx.tcpip.net.br/categories/networking/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>XDP &amp; eBPF Block DoS</title>
      <link>http://0xttfx.tcpip.net.br/posts/xdpebpf-block-ddos/</link>
      <pubDate>Wed, 22 Jan 2025 17:13:52 -0300</pubDate><author>thiago.faioli@gmail.com (Faioli a.k.a 0xttfx)</author>
      <guid>http://0xttfx.tcpip.net.br/posts/xdpebpf-block-ddos/</guid>
      <category domain="http://0xttfx.tcpip.net.br/categories/networking/">Networking</category>
      <description>&lt;p&gt;Segue um teste para aplicar os conceitos de eBPF! É um esboço de uma solução que espera ser funcional e que combina um programa &lt;a href=&#34;https://prototype-kernel.readthedocs.io/en/latest/networking/XDP/introduction.html#what-is-xdp&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;XDP&lt;/a&gt;/&lt;a href=&#34;https://ebpf.io/&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;eBPF&lt;/a&gt; em C com um script em Bash(antes de usar Go) para monitorar o tráfego e atualizar dinamicamente um &lt;a href=&#34;https://docs.cilium.io/en/latest/reference-guides/bpf/architecture/#maps&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;map&lt;/a&gt; &lt;a href=&#34;https://ebpf.io/&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;eBPF&lt;/a&gt; com sources IPs que devem ser bloqueados quando idenficado um possível ataque &lt;a href=&#34;https://attack.mitre.org/techniques/T0814/&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;DoS&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Nesse cenário, o programa XDP/eBPF já está instalado na interface de rede e bloqueia pacotes provenientes de IPs listados no &lt;a href=&#34;https://docs.cilium.io/en/latest/reference-guides/bpf/architecture/#maps&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;map&lt;/a&gt;.&lt;/li&gt;&#xA;&lt;li&gt;O script em Bash monitora  o arquivo de subsistema de rastreamento &lt;a href=&#34;https://conntrack-tools.netfilter.org&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;conntrack&lt;/a&gt; do &lt;a href=&#34;https://www.netfilter.org/&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;Netfilter&lt;/a&gt; &lt;a href=&#34;https://conntrack-tools.netfilter.org/manual.html#conntrack&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;/proc/net/nf_conntrack&lt;/a&gt; para determinar se o número de conexões ativas ultrapassou o threshold configurado, e que ao ser atingido:&#xA;&lt;ul&gt;&#xA;&lt;li&gt;um log gerado por regras específicas &lt;a href=&#34;https://www.netfilter.org/projects/nftables/index.html&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;nftables&lt;/a&gt; é analisado para identificar com base em uma &amp;ldquo;janela&amp;rdquo; de tempo, qual source IP ultrapassou o limite de conexões: indicando ser um possível ataque DoS:&#xA;&lt;ul&gt;&#xA;&lt;li&gt;que então é inserido no &lt;code&gt;map&lt;/code&gt; eBPF, fazendo com que o programa XDP passe a descartar os pacotes desses endereços.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;1-pré-requisitos&#34; class=&#34;heading-element&#34;&gt;&lt;span&gt;1. Pré-requisitos&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-pr%c3%a9-requisitos&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;ul&gt;&#xA;&lt;li&gt;Kernel Linux com suporte a &lt;a href=&#34;https://docs.cilium.io/en/latest/reference-guides/bpf/index.html#bpf-and-xdp-reference-guide&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;eBPF e XDP&lt;/a&gt;&lt;br&gt;&#xA;Certifique-se de utilizar uma distribuição com kernel moderno (&amp;gt;= 4.18, de preferência 5.x ou superior).&lt;/li&gt;&#xA;&lt;li&gt;clang&lt;/li&gt;&#xA;&lt;li&gt;llvm&lt;/li&gt;&#xA;&lt;li&gt;gcc&lt;/li&gt;&#xA;&lt;li&gt;libbpf&lt;/li&gt;&#xA;&lt;li&gt;libbpf-devel&lt;/li&gt;&#xA;&lt;li&gt;libxdp&lt;/li&gt;&#xA;&lt;li&gt;libxdp-devel&lt;/li&gt;&#xA;&lt;li&gt;xdp-tools&lt;/li&gt;&#xA;&lt;li&gt;bpftool kernel-headers&lt;/li&gt;&#xA;&lt;li&gt;perf&lt;/li&gt;&#xA;&lt;li&gt;nftables&lt;/li&gt;&#xA;&lt;li&gt;iproute2&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;considrações-e-limitações&#34; class=&#34;heading-element&#34;&gt;&lt;span&gt;Considrações e Limitações&lt;/span&gt;&#xA;  &lt;a href=&#34;#considra%c3%a7%c3%b5es-e-limita%c3%a7%c3%b5es&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Rastreamento de Conexões:&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
